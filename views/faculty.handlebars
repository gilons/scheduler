<html>

<head>
     <link href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
   <link href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.dataTables.min.css">  
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link media="all" type="text/css" rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css">
    <style>
        #divAction {
            background-color: wheat;
            width: 350px;
            height: relative;
            border: 25% solid green;
            padding: 1%;
            margin: 1%;
            text-align: left;
        }
    
        #divAction1 {
            background-color: wheat;
            width: 100%;
            height: relative;
            border: 25% solid green;
            padding: 15% 5% 6% 8%;
            margin: 2%;
            text-align: left;
        }

        #divAction2 {
            background-color: wheat;
            width: 100%;
            height: relative;
            border: 25% solid green;
            padding: 15% 5% 6% 8%;
            margin: 1%;
            text-align: left;
        }


        #divAbout {
            background-color: wheat;
            width: 320px;
            border: 25% solid green;
            padding: 1%;
            margin: 1%;
            height: relative;

        }

        div.left {
            width: 20%;
            padding: 0 0 0 5%;
            float: left;
            size: 1%
        }
        #highlight{
            color:crimson;
            background-color: wheat;
            font-weight: bold
        }
        div.middle {
            width: 90%;
            padding: 0% 6% 2% 25%;
            border: 25% solid green;
            float: center;

        }

        body {
            min-width: 700px;
        }

        div.right {
            width: 20%;
            padding: 0 5% 0 0;
            float: right;
        } 
        .container{
            border-radius:40px;
            padding-top: 30px;
        width: 95%;
            height: relative;
        }
    </style>
</head>

<body style="background-color:black"><br><br>
<center><h2 style="background-color:aliceblue; width:20%">{{facname}}</h2></center>
    <div class="container" style="background-color:white">
        <div id="divAbout" class="right">
            <div id="divAction1">
                <center>
                    <h4>
                        <b>Enter your courses to scheduled</b>
                        <h4>
                            <form action="#" method="POST" id="coursenew">
                                <table>
                                    <tr>
                                        <td>
                                            <label for="">course</label>
                                        </td>
                                        <td>
                                            <lable>N.R</lable>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <input id="coursename" type="text" placeholder="couse name" style="width:90%" required>
                                        </td>
                                        <td>
                                            <input type="number" id="coursenum" placeholder="No" style="width:80%;" required>
                                        </td>
                                        <td>
                                            <input type="submit" value="save" style="width:100%; background-color:orange; border:0px">
                                        </td>
                                    </tr>
                                </table>
                            </form>
                            <br>
                            <br>
                            <h4>
                                <b>Saved Courses</b>
                            </h4>
                            <br>
                            <ul id="added">
                                {{#each course}}
                                <li>
                                    <b>
                                    {{name}} &emsp13; &emsp13; &emsp13; &emsp13; {{value}}&emsp13; <button class="btn-danger" style="border:0; font-size:80%" id="{{name}}" onclick="dropthiscourse(this.id)" >drop</button>
                                    </b>
                                </li>
                                {{/each}}
                            </ul>
                            <button class=" btn-danger " id="dropcourse" style="border:0; width:25%;">Drop All</button>
                            <br>
                            <br>
                </center>
                <center>
                    <div class="btn-group">
                        <div class="left">
                            <button class=" btn-success pull-right " id="schedule" style="border:0; width:400%;">Schedule</button>
                        </div>
                        <div class="right">
                            <button class="pull-left" id="courserefresh" style="border:0; width:400%; background-color:orange;">Refresh</button>
                        </div>
                        <br><br>
                        <div>
                            <input type="button" class="btn btn-success btn-primary btn-sm" value="Show Scheduled" data-toggle="modal" id="scheduled"
                                data-target="#showscheduled" style="border:0px;  border-radius:0px">
                        </div>
                    </div>
                </center>

            </div>
        </div>
        <div class="modal fade" id="showscheduled" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog" id="choose">
        
                <div class="modal-header">
                    <h4 class="modal-title">
                        <center id="detail1" style="background-color:#F7B432;">TIME TABLE PREVIEWER</center>
                    </h4>
                </div>
                            <div class="container">
                                {{#each week}}
                                <div id="{{this}}" class="giles" style="background-color:white; width:100% ">
                                    <center>
                                        <h4>WEEK-{{add1 this}}</h4>
                                    </center>
                                    <br>
                                    <table style="width:100%" border="1" style="border-color:orange; background-color:dimgrey">
                                        <tr>
                                            <th style="font-size:10px">
                                                <center>Day</center>
                                            </th>
                                            {{#each ../periods}}
                                            <th style="font-size:10px">
                                                <center>{{this}}</center>
                                            </th>{{/each}}
                                        </tr>
                                        {{#each ../day}}
                                        <tr style="font-size:10px">
                                            <td>
                                                <center>{{this}}</center>
                                            </td>
                                            {{#each ../../periods}}
                                            <td id="{{id1 ../../this ..this this}}list" style="font-size:10px">
                                            </td>
                                            {{/each}}
                                        </tr>
                                        {{/each}}
                                    </table>
                                </div>{{/each}}
                                <br>
                                <br>
                            </div>
                <div class="modal-footer">
                    <button class="btn btn-default pull-right" id="close" data-dismiss="modal" style="border-radius:0%; color:white; border-color:#F7B432; background-color:orange"
                        title="close the window">CLOSE</button>
                        <button class="btn btn-default pull-left" id="download" style="border-radius:0%; color:black; border-color:#F7B432;" title="close the window">Download</button>
                </div>
        
            </div>
        </div>
        <div id="divAction" class="left">
            <div id="divAction2">
                <center>
                    <h4>
                        <b>CREAT DEPARTMENT</b>
                        <h4>
                            <form action="#" method="POST" id="create">
                                <table>
                                    <tr>
                                        <td>
                                            <label for="">name</label>
                                        </td>
                                        <td>
                                            <lable>password</lable>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <input id="departname" type="text" placeholder="name" style="width:90%" required>
                                        </td>
                                        <td>
                                            <input type="password" id="departnum" placeholder="password" style="width:80%;" required>
                                        </td>
                                        <td>
                                            <input type="submit" value="save" style="width:100%; background-color:orange; border:0px">
                                        </td>
                                    </tr>
                                </table>
                            </form>
                            <br>
                            <br>
                            <div>
                                <center>
                                    <h4>
                                        <b>ADDED DEPARTMENTS</b>
                                    </h4>
                                </center>
                                <ul id="facs">
                                    {{#each facs}}
                                    <li>
                                        <h5 style="color:black;">{{this}}</h5>
                                    </li>
                                    {{/each}}
                                </ul>
                            </div>
                            <br>
                            <br>
                            <center>
                                <div class="btn-group" style="font-size:80%">
                                    <div class="left">
                                        <button class=" btn-danger pull-right " id="departdrop" style="border:0; width:400%;">Drop All</button>
                                    </div>
                                    <div class="right">
                                        <button class="pull-left" id="departrefresh" style="border:0; width:400%; background-color:orange;">Refresh</button>
                                    </div>
                                </div>
                            </center>
                            <br>
                            <div style="background-color:floralwhite;height:10%">
                                <center>
                                    <h4>
                                        This is your password:
                                    </h4>
                                    <h5>
                                        {{keyword}}
                                    </h5>
                                </center>
                            </div>

                </center>
            </div>
        </div>
    </div>
    </div>
</body>
<ul>
    <li>
        <h3>{{name}}</h3>
    </li>
</ul>
</script>
<script type="text/javascript" scr="handlebars-v4.0.11.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"> </script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js"></script>
<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src='pdfmake-master/build/pdfmake.min.js'></script>
<script src='pdfmake-master/build/vfs_fonts.js'></script>
<script type="text/javascript">
function dropthiscourse(coursename) {
     $.post("http://localhost:3000/dropthiscourse", { value: coursename }, function (data) {
        location.reload();
    });
}
    function writeskeduled(scheduled) {
        for (var i = 0; i < scheduled.length; i++) {
            var id = scheduled[i][0] + "list";
            document.getElementById(id).innerHTML = null;
            var temp = (scheduled[i][1] === null)?'':scheduled[i][1];
            document.getElementById(id).innerHTML = "<tr><td>" + temp + "</td></tr>";
        }
    }
    function generatetable(periods, day, week, scheduled, period, callback) {
            var temp = [periods];
            var i = 0;
            var x = 0;
            var j = 0;
            for (i = 0; i < week.length; i++) {
                for (j = 0; j < day.length; j++) {
                    var temp2 = [];
                    temp2.push(day[j]);
                    for (x = 0; x < periods.length - 1; x++) {
                        var tempo = { table: { width: ['auto', 'auto'], body: [['course', 'venue']], } };
                        var address = week[i] + day[j].substr(0, 3) + '_' + periods[x + 1].substr(0, 2);
                        if(scheduled[period.indexOf(address)][1]){
                           var temparray = scheduled[period.indexOf(address)][1].split('<br/>');
                            for (var y = 0; y < temparray.length - 1; y++) {
                           var tempstring = temparray[y].split('<br>').join('');
                         tempo.table.body.push([tempstring.split('-')[0], tempstring.split('-')[1]]);
                            }
                         temp2.push(tempo);
                        }else{
                             temp2.push('');
                        }
                    }
                    temp.push(temp2);
                }
                j = 0;
                x = 0;
            }
            callback(temp);
        }
    function addday(periods) {
        var temp = ['Day'];
        for (var i = 0; i < periods.length; i++) {
            temp.push(periods[i]);
        }
        return temp;
    }
        $('#download').on('click', function () {
       var scheduled = {{{ tojava scheduled }}};
        var periods = {{{ tojava periods }}};
        periods = addday(periods);
        var day = {{{ tojava day }}};
        var week = {{{ tojava week }}};
        var period = {{{ tojava period }}};
        generatetable(periods, day, week, scheduled, period, function (tabledata) {
            var docDefinition = {
                content: [
                    {
                        table: {
                            headerRows: 1,
                            widths: ['auto', 'auto', 'auto', 'auto'],

                            body: tabledata
                        }
                        , fontSize: 7
                    }
                ]
            };
            pdfMake.createPdf(docDefinition).open();
        })
    });
    $("#dropcourse").on('click', function () {
        var r = confirm("Your are about to drop all courses for this faculty");
        if (r == true) {
        var data = [];
        data.push("drop");
        $.ajax({
            type: 'POST',
            data: JSON.stringify(data),
            contentType: "application/json",
            url: "http://localhost:3000/drop",
            success: function (data) {
               location.reload();
            }
        });
        }
    });
    
    $('document').ready(function (){
        var scheduled = {{{tojava scheduled}}};
         writeskeduled(scheduled);
    });
    $("#courserefresh").on('click', function () {
        location.reload();
    });
    $("#departrefresh").on('click', function () {
        location.reload();
    });
    $("#schedule").on('click', function () {
        window.location = "http://localhost:3000/schedule";
    });
    $("#coursenew").on('submit', function (event) {
        event.preventDefault();
        var name = [];
        name[0] = $("#coursename").val();
        name[1] = $("#coursenum").val();
        name[1] = parseInt(name[1]);
        var data = {};
        data.value = name;
        $.ajax({
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json',
            url: "http://localhost:3000/addcourses",
            success: function (data) {
                if (data == "no") {
                    alert("an error occured during the addidion of the couses");
                } else {
                    var newcouse = '<li><b>' + data[0] +
                        '  &emsp13; &emsp13; &emsp13; ' + data[1] +
                        '&emsp13; <button class="btn-danger" style="border:0; font-size:80%" id="'+data[0]+'" '+
                        'onclick="dropthiscourse(this.id)" >drop</button></li></b>';
                    document.getElementById("added").innerHTML += newcouse;
                }

            }
        });

    });
    $("#create").on('submit', function (event) {
        event.preventDefault();
        var name = [];
        name[0] = $("#departname").val();
        name[1] = $("#departnum").val();
        var data = {};
        alert(name);
        data.value = name;
        $.ajax({
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json',
            url: "http://localhost:3000/depcreate",
            success: function (data) {
                if (data == "no") {
                    alert("an error occured during the addidion of the couses");
                } else {
                    var newcouse = '<li><b>' + data[0] +
                        '  &emsp13; &emsp13; &emsp13; &emsp13; ' + data[1] +
                        '</li></b>';

                    document.getElementById("facs").innerHTML += newcouse;
                }

            }
        });

    });
</script>

</html>